machine:
  services:
    - docker
    - redis
    - postgresql
  node:
    version:
      0.10.39
dependencies:
  pre:
    - echo "" > ~/.gitconfig
  override:
    - ./bin/install_dependencies.sh
  cache_directories:
    - "~/.go_workspace"
    - "/home/ubuntu/.gimme"
database:
  override:
    - PGPASSWORD=unicode psql -U ubuntu -d circle_test -f v02/resources/db/pgsql.sql -h 127.0.0.1
test:
  pre:
    - mkdir -p /home/ubuntu/.go_workspace/src/github.com/tapglue
    - ln -nfs /home/ubuntu/backend /home/ubuntu/.go_workspace/src/github.com/tapglue/backend
    - ./bin/test_configs.sh intaker
    - cd dashboard && npm run lint
  override:
    - ./bin/run_tests.sh intaker postgres
    - ./bin/run_tests.sh intaker redis
    - ./bin/run_tests.sh intaker kinesis
    - ./bin/run_tests.sh distributor postgres
    - cd dashboard && npm run test
  post:
    - ./bin/process_coverage.sh
deployment:
  s3:
    branch: master
    commands:
      - ./bin/make_release.sh intaker redis
      - ./bin/make_release.sh intaker kinesis
      - ./bin/make_release.sh intaker postgres
      - ./bin/make_release.sh distributor postgres
      - ./bin/make_release.sh corporate styleguide
      - ./bin/make_release.sh corporate dashboard
      - ./bin/make_release.sh corporate website
